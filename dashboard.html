<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teaching Methods Dashboard - VidyaMitra</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: #f5f7fa; color: #1f2937; min-height: 100vh; }
        .header { background: linear-gradient(135deg, #1a56db 0%, #1e40af 100%); color: white; padding: 24px 32px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px; }
        .header h1 { font-size: 1.5rem; font-weight: 700; display: flex; align-items: center; gap: 12px; }
        .btn { display: inline-flex; align-items: center; gap: 8px; padding: 10px 20px; border-radius: 8px; font-weight: 600; font-size: 0.9rem; text-decoration: none; transition: all 0.2s; cursor: pointer; border: none; }
        .btn-white { background: white; color: #1a56db; }
        .btn-white:hover { background: #f0f0f0; }
        .container { max-width: 1400px; margin: 0 auto; padding: 32px; }
        .stats-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 32px; }
        .stat-card { background: white; padding: 24px; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .stat-card .number { font-size: 2rem; font-weight: 700; color: #1a56db; }
        .stat-card .label { color: #6b7280; font-size: 0.9rem; margin-top: 4px; }
        .filters { background: white; padding: 20px; border-radius: 12px; margin-bottom: 24px; display: flex; gap: 16px; flex-wrap: wrap; align-items: center; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .filters select, .filters input { padding: 10px 14px; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 0.9rem; min-width: 150px; }
        .filters select:focus, .filters input:focus { outline: none; border-color: #1a56db; }
        .table-container { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        table { width: 100%; border-collapse: collapse; }
        th { background: #f9fafb; padding: 14px 16px; text-align: left; font-weight: 600; font-size: 0.85rem; color: #6b7280; text-transform: uppercase; border-bottom: 1px solid #e5e7eb; }
        td { padding: 16px; border-bottom: 1px solid #f3f4f6; font-size: 0.9rem; }
        tr:hover { background: #f9fafb; }
        .badge { display: inline-block; padding: 4px 10px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; }
        .badge-math { background: #dbeafe; color: #1e40af; }
        .badge-science { background: #d1fae5; color: #065f46; }
        .badge-english { background: #fef3c7; color: #92400e; }
        .badge-social { background: #fce7f3; color: #9d174d; }
        .method-preview { max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; color: #6b7280; }
        .class-badge { background: #f3f4f6; color: #374151; padding: 4px 10px; border-radius: 6px; font-weight: 600; font-size: 0.85rem; }
        .view-btn { color: #1a56db; text-decoration: none; font-weight: 500; cursor: pointer; }
        .view-btn:hover { text-decoration: underline; }
        .empty-state { text-align: center; padding: 60px 20px; color: #6b7280; }
        .empty-state h3 { font-size: 1.25rem; margin-bottom: 8px; color: #374151; }
        .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; padding: 20px; }
        .modal.active { display: flex; }
        .modal-content { background: white; border-radius: 16px; max-width: 700px; width: 100%; max-height: 90vh; overflow-y: auto; padding: 32px; }
        .modal-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 24px; }
        .modal-header h2 { font-size: 1.5rem; color: #1f2937; }
        .modal-close { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #6b7280; }
        .modal-section { margin-bottom: 20px; }
        .modal-section h4 { font-size: 0.85rem; text-transform: uppercase; color: #6b7280; margin-bottom: 8px; }
        .modal-section p { color: #374151; line-height: 1.6; white-space: pre-wrap; }
        .loading { text-align: center; padding: 40px; color: #6b7280; }
        @media (max-width: 768px) { .container { padding: 16px; } .table-container { overflow-x: auto; } table { min-width: 800px; } }
    </style>
</head>
<body>
    <div class="header">
        <h1><span>ðŸ“š</span> Teaching Methods Dashboard</h1>
        <div><a href="/teacher" class="btn btn-white">+ Add New Method</a></div>
    </div>
    <div class="container">
        <div class="stats-row">
            <div class="stat-card"><div class="number" id="totalMethods">-</div><div class="label">Total Methods</div></div>
            <div class="stat-card"><div class="number" id="totalTeachers">-</div><div class="label">Teachers</div></div>
            <div class="stat-card"><div class="number" id="totalSubjects">-</div><div class="label">Subjects</div></div>
            <div class="stat-card"><div class="number" id="totalClasses">-</div><div class="label">Classes Covered</div></div>
        </div>
        <div class="filters">
            <select id="filterSubject"><option value="">All Subjects</option><option value="Mathematics">Mathematics</option><option value="Science">Science</option><option value="English">English</option><option value="Social Studies">Social Studies</option></select>
            <select id="filterClass"><option value="">All Classes</option><option value="1">Class 1</option><option value="2">Class 2</option><option value="3">Class 3</option><option value="4">Class 4</option><option value="5">Class 5</option><option value="6">Class 6</option><option value="7">Class 7</option><option value="8">Class 8</option><option value="9">Class 9</option><option value="10">Class 10</option><option value="11">Class 11</option><option value="12">Class 12</option></select>
            <input type="text" id="searchInput" placeholder="Search chapter or teacher...">
        </div>
        <div class="table-container">
            <table>
                <thead><tr><th>Chapter/Topic</th><th>Subject</th><th>Class</th><th>Teacher</th><th>Method Preview</th><th>Added On</th><th>Action</th></tr></thead>
                <tbody id="methodsTable"><tr><td colspan="7" class="loading">Loading teaching methods...</td></tr></tbody>
            </table>
        </div>
    </div>
    <div class="modal" id="viewModal">
        <div class="modal-content">
            <div class="modal-header"><h2 id="modalTitle">Chapter Name</h2><button class="modal-close" onclick="closeModal()">&times;</button></div>
            <div id="modalBody"></div>
        </div>
    </div>
    <script>
        let allMethods = [];
        async function loadMethods() {
            try {
                const response = await fetch('/api/teaching-methods');
                const data = await response.json();
                allMethods = Object.entries(data).map(([key, method]) => ({ key, ...method }));
                updateStats(); renderTable();
            } catch (error) {
                document.getElementById('methodsTable').innerHTML = '<tr><td colspan="7" class="empty-state"><h3>Error loading data</h3></td></tr>';
            }
        }
        function updateStats() {
            document.getElementById('totalMethods').textContent = allMethods.length;
            document.getElementById('totalTeachers').textContent = new Set(allMethods.map(m => m.teacher)).size;
            document.getElementById('totalSubjects').textContent = new Set(allMethods.map(m => m.subject)).size;
            document.getElementById('totalClasses').textContent = new Set(allMethods.map(m => m.class || m.classLevel)).size;
        }
        function getSubjectBadgeClass(subject) {
            if (!subject) return 'badge';
            const s = subject.toLowerCase();
            if (s.includes('math')) return 'badge badge-math';
            if (s.includes('science')) return 'badge badge-science';
            if (s.includes('english')) return 'badge badge-english';
            if (s.includes('social')) return 'badge badge-social';
            return 'badge';
        }
        function formatDate(dateString) {
            if (!dateString) return '-';
            return new Date(dateString).toLocaleDateString('en-IN', { day: 'numeric', month: 'short', year: 'numeric' });
        }
        function renderTable() {
            const subjectFilter = document.getElementById('filterSubject').value;
            const classFilter = document.getElementById('filterClass').value;
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            let filtered = allMethods.filter(m => {
                if (subjectFilter && m.subject !== subjectFilter) return false;
                const methodClass = String(m.class || m.classLevel || '');
                if (classFilter && methodClass !== classFilter) return false;
                if (searchTerm && ![m.chapter, m.teacher, m.method].join(' ').toLowerCase().includes(searchTerm)) return false;
                return true;
            });
            if (filtered.length === 0) {
                document.getElementById('methodsTable').innerHTML = '<tr><td colspan="7" class="empty-state"><h3>No teaching methods found</h3></td></tr>';
                return;
            }
            document.getElementById('methodsTable').innerHTML = filtered.map(m => 
                '<tr><td><strong>' + (m.chapter || '-') + '</strong></td><td><span class="' + getSubjectBadgeClass(m.subject) + '">' + (m.subject || '-') + '</span></td><td><span class="class-badge">Class ' + (m.class || m.classLevel || '-') + '</span></td><td>' + (m.teacher || '-') + '</td><td class="method-preview">' + (m.method || '-') + '</td><td>' + formatDate(m.createdAt) + '</td><td><span class="view-btn" onclick="viewMethod(\'' + m.key + '\')">View</span></td></tr>'
            ).join('');
        }
        function viewMethod(key) {
            const m = allMethods.find(x => x.key === key);
            if (!m) return;
            document.getElementById('modalTitle').textContent = m.chapter || 'Teaching Method';
            let html = '<div class="modal-section"><h4>Subject & Class</h4><p>' + (m.subject || '-') + ' | Class ' + (m.class || m.classLevel || '-') + '</p></div>';
            html += '<div class="modal-section"><h4>Teacher</h4><p>' + (m.teacher || '-') + '</p></div>';
            html += '<div class="modal-section"><h4>Teaching Method</h4><p>' + (m.method || '-') + '</p></div>';
            if (m.example) html += '<div class="modal-section"><h4>Real-life Example</h4><p>' + m.example + '</p></div>';
            if (m.commonMistakes || m.mistakes) html += '<div class="modal-section"><h4>Common Mistakes</h4><p>' + (m.commonMistakes || m.mistakes) + '</p></div>';
            if (m.tips) html += '<div class="modal-section"><h4>Tips for Parents</h4><p>' + m.tips + '</p></div>';
            document.getElementById('modalBody').innerHTML = html;
            document.getElementById('viewModal').classList.add('active');
        }
        function closeModal() { document.getElementById('viewModal').classList.remove('active'); }
        document.getElementById('filterSubject').addEventListener('change', renderTable);
        document.getElementById('filterClass').addEventListener('change', renderTable);
        document.getElementById('searchInput').addEventListener('input', renderTable);
        document.getElementById('viewModal').addEventListener('click', (e) => { if (e.target.id === 'viewModal') closeModal(); });
        loadMethods();
    </script>
</body>
</html>
